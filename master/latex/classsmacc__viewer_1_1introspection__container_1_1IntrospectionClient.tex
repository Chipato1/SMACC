\hypertarget{classsmacc__viewer_1_1introspection__container_1_1IntrospectionClient}{}\section{smacc\+\_\+viewer.\+introspection\+\_\+container.\+Introspection\+Client Class Reference}
\label{classsmacc__viewer_1_1introspection__container_1_1IntrospectionClient}\index{smacc\+\_\+viewer.\+introspection\+\_\+container.\+Introspection\+Client@{smacc\+\_\+viewer.\+introspection\+\_\+container.\+Introspection\+Client}}


Collaboration diagram for smacc\+\_\+viewer.\+introspection\+\_\+container.\+Introspection\+Client\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=238pt]{classsmacc__viewer_1_1introspection__container_1_1IntrospectionClient__coll__graph}
\end{center}
\end{figure}
\subsection*{Public Member Functions}
\begin{DoxyCompactItemize}
\item 
def \hyperlink{classsmacc__viewer_1_1introspection__container_1_1IntrospectionClient_adfc8a30eb9691a1fcec3f8e54fb491bc}{get\+\_\+servers} (self)
\item 
def \hyperlink{classsmacc__viewer_1_1introspection__container_1_1IntrospectionClient_afc46c103e4237c9a4e14de8abaf4c152}{set\+\_\+initial\+\_\+state} (self, server, path, initial\+\_\+states, initial\+\_\+userdata=\hyperlink{classsmacc__viewer_1_1smacc__user__data_1_1UserData}{User\+Data}(), timeout=None)
\end{DoxyCompactItemize}


\subsection{Detailed Description}


Definition at line 23 of file introspection\+\_\+container.\+py.



\subsection{Member Function Documentation}
\index{smacc\+\_\+viewer\+::introspection\+\_\+container\+::\+Introspection\+Client@{smacc\+\_\+viewer\+::introspection\+\_\+container\+::\+Introspection\+Client}!get\+\_\+servers@{get\+\_\+servers}}
\index{get\+\_\+servers@{get\+\_\+servers}!smacc\+\_\+viewer\+::introspection\+\_\+container\+::\+Introspection\+Client@{smacc\+\_\+viewer\+::introspection\+\_\+container\+::\+Introspection\+Client}}
\subsubsection[{\texorpdfstring{get\+\_\+servers(self)}{get_servers(self)}}]{\setlength{\rightskip}{0pt plus 5cm}def smacc\+\_\+viewer.\+introspection\+\_\+container.\+Introspection\+Client.\+get\+\_\+servers (
\begin{DoxyParamCaption}
\item[{}]{self}
\end{DoxyParamCaption}
)}\hypertarget{classsmacc__viewer_1_1introspection__container_1_1IntrospectionClient_adfc8a30eb9691a1fcec3f8e54fb491bc}{}\label{classsmacc__viewer_1_1introspection__container_1_1IntrospectionClient_adfc8a30eb9691a1fcec3f8e54fb491bc}
\begin{DoxyVerb}Get the base names that are broadcasting smacc states.\end{DoxyVerb}
 

Definition at line 24 of file introspection\+\_\+container.\+py.



References smacc\+\_\+viewer.\+introspection\+\_\+container.\+Introspection\+Client.\+set\+\_\+initial\+\_\+state().


\begin{DoxyCode}
24     \textcolor{keyword}{def }\hyperlink{classsmacc__viewer_1_1introspection__container_1_1IntrospectionClient_adfc8a30eb9691a1fcec3f8e54fb491bc}{get\_servers}(self):
25         \textcolor{stringliteral}{"""Get the base names that are broadcasting smacc states."""}
26 
27         \textcolor{comment}{# Get the currently broadcasted smacc introspection topics}
28         topics = rostopic.find\_by\_type(\textcolor{stringliteral}{'smacc\_msgs/SmaccContainerStatus'})
29 
30         \textcolor{keywordflow}{return} [t[:t.rfind(STATUS\_TOPIC)] \textcolor{keywordflow}{for} t \textcolor{keywordflow}{in} topics]
31 
\end{DoxyCode}


Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{classsmacc__viewer_1_1introspection__container_1_1IntrospectionClient_adfc8a30eb9691a1fcec3f8e54fb491bc_cgraph}
\end{center}
\end{figure}


\index{smacc\+\_\+viewer\+::introspection\+\_\+container\+::\+Introspection\+Client@{smacc\+\_\+viewer\+::introspection\+\_\+container\+::\+Introspection\+Client}!set\+\_\+initial\+\_\+state@{set\+\_\+initial\+\_\+state}}
\index{set\+\_\+initial\+\_\+state@{set\+\_\+initial\+\_\+state}!smacc\+\_\+viewer\+::introspection\+\_\+container\+::\+Introspection\+Client@{smacc\+\_\+viewer\+::introspection\+\_\+container\+::\+Introspection\+Client}}
\subsubsection[{\texorpdfstring{set\+\_\+initial\+\_\+state(self, server, path, initial\+\_\+states, initial\+\_\+userdata=\+User\+Data(), timeout=\+None)}{set_initial_state(self, server, path, initial_states, initial_userdata=UserData(), timeout=None)}}]{\setlength{\rightskip}{0pt plus 5cm}def smacc\+\_\+viewer.\+introspection\+\_\+container.\+Introspection\+Client.\+set\+\_\+initial\+\_\+state (
\begin{DoxyParamCaption}
\item[{}]{self, }
\item[{}]{server, }
\item[{}]{path, }
\item[{}]{initial\+\_\+states, }
\item[{}]{initial\+\_\+userdata = {\ttfamily {\bf User\+Data}()}, }
\item[{}]{timeout = {\ttfamily None}}
\end{DoxyParamCaption}
)}\hypertarget{classsmacc__viewer_1_1introspection__container_1_1IntrospectionClient_afc46c103e4237c9a4e14de8abaf4c152}{}\label{classsmacc__viewer_1_1introspection__container_1_1IntrospectionClient_afc46c103e4237c9a4e14de8abaf4c152}
\begin{DoxyVerb}Set the initial state of a smacc server.

@type server: string
@param server: The name of the introspection server to which this client
should connect.

@type path: string
@param path: The path to the target container in the state machine.

@type initial_states: list of string
@param inital_state: The state the target container should take when it
starts. This is as list of at least one state label.

@type initial_userdata: UserData
@param initial_userdata: The userdata to inject into the target container.

@type timeout: rospy.Duration
@param timeout: Timeout for this call. If this is set to None, it will not
block, and the initial state may not be set before the target state machine
goes active.
\end{DoxyVerb}
 

Definition at line 37 of file introspection\+\_\+container.\+py.



Referenced by smacc\+\_\+viewer.\+introspection\+\_\+container.\+Introspection\+Client.\+get\+\_\+servers().


\begin{DoxyCode}
37             timeout = \textcolor{keywordtype}{None}):
38         \textcolor{stringliteral}{"""Set the initial state of a smacc server.}
39 \textcolor{stringliteral}{        }
40 \textcolor{stringliteral}{        @type server: string}
41 \textcolor{stringliteral}{        @param server: The name of the introspection server to which this client}
42 \textcolor{stringliteral}{        should connect.}
43 \textcolor{stringliteral}{}
44 \textcolor{stringliteral}{        @type path: string}
45 \textcolor{stringliteral}{        @param path: The path to the target container in the state machine.}
46 \textcolor{stringliteral}{}
47 \textcolor{stringliteral}{        @type initial\_states: list of string}
48 \textcolor{stringliteral}{        @param inital\_state: The state the target container should take when it}
49 \textcolor{stringliteral}{        starts. This is as list of at least one state label.}
50 \textcolor{stringliteral}{}
51 \textcolor{stringliteral}{        @type initial\_userdata: UserData}
52 \textcolor{stringliteral}{        @param initial\_userdata: The userdata to inject into the target container.}
53 \textcolor{stringliteral}{}
54 \textcolor{stringliteral}{        @type timeout: rospy.Duration}
55 \textcolor{stringliteral}{        @param timeout: Timeout for this call. If this is set to None, it will not}
56 \textcolor{stringliteral}{        block, and the initial state may not be set before the target state machine}
57 \textcolor{stringliteral}{        goes active.}
58 \textcolor{stringliteral}{        """}
59 
60         \textcolor{comment}{# Construct initial state command}
61         initial\_status\_msg = SmaccContainerInitialStatusCmd(
62                 path = path,
63                 initial\_states = initial\_states,
64                 local\_data = pickle.dumps(initial\_userdata.\_data,2))
65 
66         \textcolor{comment}{# A status message to receive confirmation that the state was set properly}
67         msg\_response = SmaccContainerStatus()
68 
69         \textcolor{comment}{# Define a local callback to just stuff a local message}
70         \textcolor{keyword}{def }local\_cb(msg, msg\_response):
71             rospy.logdebug(\textcolor{stringliteral}{"Received status response: "}+str(msg))
72             msg\_response.path = msg.path
73             msg\_response.initial\_states = msg.initial\_states
74             msg\_response.local\_data = msg.local\_data
75 
76         \textcolor{comment}{# Create a subscriber to verify the request went through}
77         state\_sub = rospy.Subscriber(server+STATUS\_TOPIC, SmaccContainerStatus,
78                 callback=local\_cb, callback\_args=msg\_response)
79 
80         \textcolor{comment}{# Create a publisher to send the command}
81         rospy.logdebug(\textcolor{stringliteral}{"Sending initial state command: "}+str(initial\_status\_msg.path)+\textcolor{stringliteral}{" on topic '"}+server+
      INIT\_TOPIC+\textcolor{stringliteral}{"'"})
82         init\_pub = rospy.Publisher(server+INIT\_TOPIC,
83                 SmaccContainerInitialStatusCmd, queue\_size=1)
84         init\_pub.publish(initial\_status\_msg)
85 
86         start\_time = rospy.Time.now()
87 
88         \textcolor{comment}{# Block until we get a new state back }
89         \textcolor{keywordflow}{if} timeout \textcolor{keywordflow}{is} \textcolor{keywordflow}{not} \textcolor{keywordtype}{None}:
90             \textcolor{keywordflow}{while} rospy.Time.now() - start\_time < timeout:
91                 \textcolor{comment}{# Send the initial state command}
92                 init\_pub.publish(initial\_status\_msg)
93 
94                 \textcolor{comment}{# Filter messages that are from other containers}
95                 \textcolor{keywordflow}{if} msg\_response.path == path:
96                     \textcolor{comment}{# Check if the heartbeat came back to match}
97                     state\_match = all([s \textcolor{keywordflow}{in} msg\_response.initial\_states \textcolor{keywordflow}{for} s \textcolor{keywordflow}{in} initial\_states])
98                     local\_data = \hyperlink{classsmacc__viewer_1_1smacc__user__data_1_1UserData}{UserData}()
99                     local\_data.\_data = pickle.loads(msg\_response.local\_data)
100                     ud\_match = all([\(\backslash\)
101                             (key \textcolor{keywordflow}{in} local\_data \textcolor{keywordflow}{and} local\_data.\_data[key] == initial\_userdata.\_data[key])\(\backslash\)
102                             \textcolor{keywordflow}{for} key \textcolor{keywordflow}{in} initial\_userdata.\_data])
103 
104                     rospy.logdebug(\textcolor{stringliteral}{"STATE MATCH: "}+str(state\_match)+\textcolor{stringliteral}{", UD\_MATCH: "}+str(ud\_match))
105 
106                     \textcolor{keywordflow}{if} state\_match \textcolor{keywordflow}{and} ud\_match:
107                         \textcolor{keywordflow}{return} \textcolor{keyword}{True}
108                 rospy.sleep(0.3)
109             \textcolor{keywordflow}{return} \textcolor{keyword}{False}
110 
\end{DoxyCode}


Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{classsmacc__viewer_1_1introspection__container_1_1IntrospectionClient_afc46c103e4237c9a4e14de8abaf4c152_icgraph}
\end{center}
\end{figure}




The documentation for this class was generated from the following file\+:\begin{DoxyCompactItemize}
\item 
smacc\+\_\+viewer/src/smacc\+\_\+viewer/\hyperlink{introspection__container_8py}{introspection\+\_\+container.\+py}\end{DoxyCompactItemize}
